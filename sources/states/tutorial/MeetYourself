#pragma once

#include <glm/gtx/compatibility.hpp>

struct MeetYourselfTutorialStep : public TutorialStep {
    void enter(LocalizeAPI* loc, SessionComponent* sc, TutorialEntities* entities) {
        TEXT_RENDERING(entities->text)->show = false;
        TEXT_RENDERING(entities->text)->text = loc->text("previous_hero_replay");
    
        RENDERING(entities->anim)->show = true;
        TRANSFORM(entities->anim)->position = TRANSFORM(sc->runners[0])->worldPosition +
            TRANSFORM(sc->runners[0])->size * glm::vec2(0.5, 1);
        pointArrowTo(entities->anim, TRANSFORM(sc->runners[0])->worldPosition);
    }
    bool mustUpdateGame(SessionComponent* sc, TutorialEntities* entities) {
        if (glm::distance(TRANSFORM(sc->runners[0])->position, TRANSFORM(sc->runners[1])->position) > theRenderingSystem.screenW * 0.7) {
            return true;
        } else {
            TEXT_RENDERING(entities->text)->show = true;
            ANIMATION(sc->runners[0])->playbackSpeed = 0;
            ANIMATION(sc->runners[1])->playbackSpeed = 0;
            return false;
        }
    }
    bool canExit(SessionComponent* sc, TutorialEntities* ) {
        return (ANIMATION(sc->currentRunner)->playbackSpeed == 0);
    }
    
    void exit(SessionComponent* sc, TutorialEntities* ) {
        ANIMATION(sc->runners[0])->playbackSpeed = ANIMATION(sc->runners[1])->playbackSpeed = 1.1;
    }
};
